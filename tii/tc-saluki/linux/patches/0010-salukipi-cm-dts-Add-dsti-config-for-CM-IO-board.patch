From 39ac3ff7a22c5d7bd0cfd5f39fc1fb3849e9c11e Mon Sep 17 00:00:00 2001
From: Govind Singh <govind.sk85@gmail.com>
Date: Fri, 8 Sep 2023 15:19:17 +0400
Subject: [PATCH] salukipi:cm:dts: Add dsti config for CM IO board

---
 arch/riscv/boot/dts/microchip/mpfs-icicle-kit.dts | 159 ++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 159 insertions(+)

diff --git a/arch/riscv/boot/dts/microchip/mpfs-icicle-kit.dts b/arch/riscv/boot/dts/microchip/mpfs-icicle-kit.dts
index 518780f..c6c4b2b 100644
--- a/arch/riscv/boot/dts/microchip/mpfs-icicle-kit.dts
+++ b/arch/riscv/boot/dts/microchip/mpfs-icicle-kit.dts
@@ -5,6 +5,7 @@
 
 #include "mpfs.dtsi"
 #include "mpfs-icicle-kit-fabric.dtsi"
+#include <dt-bindings/interrupt-controller/irq.h>
 
 /* Clock frequency (in Hz) of the rtcclk */
 #define MTIMER_FREQ		1000000
@@ -165,15 +166,29 @@
 		     <53>, <53>, <53>, <53>,
 		     <53>, <53>, <53>, <53>,
 		     <53>, <53>, <53>, <53>;
+	gpio-line-names = "", "", "", "",
+			  "", "", "", "",
+			  "", "", "", "",
+			  "", "", "", "",
+			  "", "", "", "",
+			  "max1726x_irq", // GPIO20
+			  "bq25890_irq",  // GPIO21
+			  "hspi_irq", "", // GPIO22
+			  "", "", "", "",
+			  "", "", "", "";
+
 	status = "okay";
+	ngpios = <32>;
 };
 
 &i2c0 {
 	status = "okay";
+	clock-frequency = <400000>;
 };
 
 &i2c1 {
 	status = "okay";
+	clock-frequency = <400000>;
 	pac193x: adc@10 {
 		compatible = "microchip,pac1934";
 		reg = <0x10>;
@@ -200,6 +215,149 @@
 			microchip,channel-enabled;
 		};
 	};
+
+	expander: gpio@24 {
+		compatible = "nxp,pca9570";
+		reg = <0x24>;
+		gpio-controller;
+		#gpio-cells = <2>;
+		gpio-line-names = "poweroff",
+				"j701",
+				"j702",
+				"nrf52_reset";
+	};
+
+	pcf85063@51 {
+		compatible = "nxp,pcf85063";
+		reg = <0x51>;
+	};
+
+	fanctrl: emc2305@4d {
+		compatible = "microchip,emc2305";
+		reg = <0x4d>;
+
+		#cooling-cells = <0x02>;
+
+		fan@0 {
+			min-rpm = /bits/ 16 <50>;
+			max-rpm = /bits/ 16 <5500>;
+		};
+	};
+
+        ina209@40 {
+                compatible = "ti,ina209";
+                reg = <0x40>;
+                shunt-resistor = <33000>;
+        };
+
+        ina209@45 {
+                compatible = "ti,ina209";
+                reg = <0x45>;
+                shunt-resistor = <33000>;
+        };
+
+        tmp100@49 {
+                compatible = "ti,tmp100";
+                reg = <0x49>;
+        };
+
+        /* available in wing board */
+        tmp100@4f {
+                compatible = "ti,tmp100";
+                reg = <0x4f>;
+        };
+
+        bq25890@6a {
+                compatible = "ti,bq25890";
+                reg = <0x6a>;
+                status = "disabled";
+
+                /* GPIO2_21 -> MSS:MSS_INT_F2M[7:7] */
+		interrupt-parent = <&plic>;
+		interrupts = <125 IRQ_TYPE_EDGE_FALLING>;
+                ti,battery-regulation-voltage = <4208000>;
+                ti,charge-current = <2048000>;
+                ti,termination-current = <256000>;
+                ti,precharge-current = <128000>;
+                ti,minimum-sys-voltage = <3500000>;
+                ti,boost-voltage = <5000000>;
+                ti,boost-max-current = <1000000>;
+
+                ti,use-ilim-pin;
+                ti,thermal-regulation-threshold = <120>;
+        };
+
+        MAX1726x@36 {
+                compatible  = "maxim,MAX1726x";
+                status              = "disabled";
+                reg                 = <0x36>;
+                /* GPIO2_20 -> MSS:MSS_INT_F2M[6:6] */
+		interrupt-parent    = <&plic>;
+		interrupts          = <124 IRQ_TYPE_EDGE_FALLING>;
+
+                rsense          = <5>;/* 5 miliOhm */
+                model-option    = <1>;  /* 1: EZ Model, 2: Custom INI without model table
+                                        3: Custom INI with custom model table */
+
+                talrt-min   = <0>;          /* DegreeC */
+                talrt-max   = <50>;         /* DegreeC */
+                valrt-min   = <3000>;       /* mV */
+                valrt-max   = <4500>;       /* mV */
+                salrt-min   = <1>;          /* Percent */
+                salrt-max   = <99>;         /* Percent */
+                ialrt-min   = <(-5000)>;    /* mA */
+                ialrt-max   = <5000>;       /* mA */
+
+
+                /*** INI parameters ***/
+                /* Option 1/2/3 */
+                designcap   = /bits/ 16 <0xC1C>; /* 3100 mAh */
+                ichgterm    = /bits/ 16 <0x0320>; /* x * 0.31250mA = 250mA => 800dec => 0x320*/
+                vempty      = /bits/ 16 <0xA561>; /* 3300 mV */
+                vcharge     = <4208>; /* 4208mV */
+
+                /* Option 2/3 */
+                learncfg    = /bits/ 16 <0xC482>;
+                rcomp0      = /bits/ 16 <0x0070>;
+                tempco      = /bits/ 16 <0x223E>;
+                qrtable00   = /bits/ 16 <0x1050>;
+                qrtable10   = /bits/ 16 <0x2013>;
+                qrtable20   = /bits/ 16 <0x0B04>;
+                qrtable30   = /bits/ 16 <0x0885>;
+
+                /* Option 2 */
+                dpacc       = /bits/ 16 <0x0C80>;
+                modelcfg    = /bits/ 16 <0x8000>;
+
+                /* Option 3 */
+                relaxcfg    = /bits/ 16 <0x2039>;
+                config      = /bits/ 16 <0x2314>;
+                config2     = /bits/ 16 <0x064F>;
+                fullsocthr  = /bits/ 16 <0x5F05>;
+                tgain       = /bits/ 16 <0xEE56>;
+                toff        = /bits/ 16 <0x1DA4>;
+                curve       = /bits/ 16 <0x0025>;
+                model-data  = /bits/ 16 <
+                /* OCV Table */
+                0x9760 0xa510 0xb100 0xb600 0xb7a0 0xb900 0xba70 0xbc70
+                0xbde0 0xbfc0 0xc250 0xc510 0xc990 0xcea0 0xd040 0xd750
+                /* X Table */
+                0x0060 0x0120 0x0240 0x0d80 0x08b0 0x0590 0x1200 0x3210
+                0x0ee0 0x0a40 0x0950 0x08e0 0x0800 0x0780 0x06b0 0x06b0
+                /* RCompSeg Table */
+                0x0100 0x0100 0x0100 0x0100 0x0100 0x0100 0x0100 0x0100
+                0x0100 0x0100 0x0100 0x0100 0x0100 0x0100 0x0100 0x0100
+                >;
+        };
+};
+
+/ {
+	power_ctrl: power_ctrl {
+		compatible = "gpio-poweroff";
+		gpios = <&expander 0 1>;
+		timeout-ms = <5000>;
+		force;
+	};
 };
 
 &i2c2 {
@@ -279,6 +437,7 @@
 };
 
 &spi0 {
+	interrupts = <54>, <126>;
 	status = "okay";
 };
 
-- 
2.25.1

